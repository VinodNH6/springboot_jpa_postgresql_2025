<!DOCTYPE HTML>
<html>
<head> 
    <title>Getting Started: Serving Web Content</title> 
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>
<body>
    <p>Get your greeting <a href="/main">here</a></p>
	
	<div style="margin:10px;">
		<button id="save-product"> save product data </button>
	</div>
	
	<div style="margin:10px;">
		<button id='fetch-products'> fetch products </button>
		<h4> List of products </h4>
		<table id="products"></table>
	</div>
		
	<script>
		
		function renderTable() {
			fetch("/api/products")
			    .then(response => response.json())
			    .then(json => {
					console.log(json);
			        // Create a variable to store HTML
			        let li = `<tr>
						<th>ID</th>
						<th>Description</th>
						<th>Name</th>
						<th>Price</th>
					</tr>`;
			      
			        // Loop through each data and add a table row
			        json.forEach(product => {
			            li += `<tr>
			                <td>${product.id} </td>
			                <td>${product.description}</td>
							<td>${product.name} </td>
							<td>${product.price}</td>
			            </tr>`;
			        });
			 
			    // Display result
			    document.getElementById("products").innerHTML = li;
			});
		}
	      async function fetchData() {
	          //const url = 'https://jsonplaceholder.typicode.com/posts/1'; // Example API endpoint
			  const localURL = '/api/products';
			  const payload = {
				//id: '10',  //it will be auto-generated by backend.
				name: 'i20',
				description: 'vinod hyndai car',
				price: '500000'
			  };
	          try {
	              const response = await fetch(localURL, {
					  method: 'POST', // Specify the HTTP method as POST
					  headers: {
					    'Content-Type': 'application/json', // Indicate that the body is JSON
					  },
					  body: JSON.stringify(payload), // Convert the JavaScript object to a JSON string
					});			 
	              if (!response.ok) {
	                  throw new Error(`HTTP error! status: ${response.status}`);
	              }

	              const data = await response.json(); // Or .text() for plain text, .blob() for binary data, etc.
	              // document.getElementById('data-container').innerText = JSON.stringify(data, null, 2);
				  console.log(data);
				  
				  let li = `<tr><th>Name</th><th>Email</th></tr>`;
				  
				  
				  
	          } catch (error) {
	              console.error('Error fetching data:', error);
	              // document.getElementById('data-container').innerText = 'Failed to load data.';
	          }
	      }

	      //fetchData(); // Call the function to initiate the fetch request when the page loads
		  document.getElementById('save-product').addEventListener('click', function() {
			console.log('clicked - save product');
			fetchData();
		  });
		  document.getElementById('fetch-products').addEventListener('click', function() {
			  console.log('clicked - fetch products');
			  renderTable();
		  });
		  
	  </script>
</body>
</html>